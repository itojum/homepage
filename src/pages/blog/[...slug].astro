---
import BaseLayout from "@/layouts/BaseLayout.astro";
import FormattedDate from "@/components/ui/FormattedDate.astro";
import { getBlogs, getBlogDetail } from "@/libs/microcms";
import { SITE_TITLE } from "@/consts";

export async function getStaticPaths() {
  const response = await getBlogs({ fields: ["id"] });
  return response.contents.map((content) => ({
    params: { slug: content.id },
  }));
}

const slug = Astro.params.slug;
const blogId = Array.isArray(slug) ? slug[0] : (slug ?? "");
const blog = await getBlogDetail(blogId, {
  depth: 2,
});
---

<BaseLayout title={blog.title} description={blog.title}>
  <main>
    <article>
      <div class="meta">
        <time class="date">
          <FormattedDate date={new Date(blog.publishedAt ?? blog.createdAt)} />
        </time>
        {
          blog.revisedAt && (
            <p class="revised">
              更新: <FormattedDate date={new Date(blog.revisedAt)} />
            </p>
          )
        }
        {(blog.category || (blog.tags && blog.tags.length > 0)) && (
          <div class="taxonomies">
            {blog.category && (
              <span class="taxonomy-item">
                <span class="taxonomy-label">カテゴリ:</span>
                <span class="category">{blog.category.name}</span>
              </span>
            )}
            {blog.tags && blog.tags.length > 0 && (
              <div class="taxonomy-item">
                <span class="taxonomy-label">タグ:</span>
                <ul class="tags" aria-label="タグ">
                  {blog.tags.map((tag) => (
                    <li><span>{tag.name}</span></li>
                  ))}
                </ul>
              </div>
            )}
          </div>
        )}
      </div>
      {blog.eyecatch?.url && (
        <div class="thumbnail">
          <img
            src={blog.eyecatch.url}
            alt=""
            width={blog.eyecatch.width}
            height={blog.eyecatch.height}
          />
        </div>
      )}
      <h1 class="title">{blog.title}</h1>
      <div class="post" set:html={blog.content} />
    </article>
  </main>
</BaseLayout>

<style>
  main {
    width: calc(100% - 2em);
    max-width: 720px;
    margin: 0 auto;
    padding: 1em;
    color: rgb(var(--gray-dark));
  }
  .meta {
    margin-bottom: 0.5em;
    color: rgb(var(--gray));
  }
  .revised {
    margin: 0;
    font-size: 0.9em;
  }
  .taxonomies {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5em 1em;
    margin-top: 0.75em;
    font-size: 0.9em;
  }
  .taxonomy-item {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.35em;
  }
  .taxonomy-label {
    color: rgb(var(--gray));
    font-size: 0.9em;
  }
  .category {
    color: rgb(var(--accent));
    font-weight: 500;
  }
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.35em;
    list-style: none;
    margin: 0;
    padding: 0;
  }
  .tags li span {
    display: inline-block;
    padding: 0.2em 0.6em;
    background: rgb(var(--gray-light));
    color: rgb(var(--gray-dark));
    border-radius: 4px;
    font-size: 0.85em;
  }
  .thumbnail {
    margin-bottom: 1em;
    height: 280px;
    overflow: hidden;
    border-radius: 8px;
  }
  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  .title {
    margin: 0 0 1em 0;
    padding-bottom: 0.5em;
    line-height: 1.2;
    color: rgb(var(--black));
    font-size: 3rem;
  }
  .post {
    line-height: 1.7;
  }
  .post :global(h2) {
    margin: 1.5em 0 0.5em;
    font-size: 2rem;
  }
  .post :global(h3) {
    margin: 1.25em 0 0.5em;
    font-size: 1.1rem;
  }
  .post :global(p) {
    margin: 0.75em 0;
  }
  .post :global(ul),
  .post :global(ol) {
    margin: 0.75em 0;
    padding-left: 1.5em;
  }
  .post :global(ul) {
    list-style: disc;
  }
  .post :global(ol) {
    list-style: decimal;
  }
  .post :global(li) {
    margin: 0.25em 0;
  }
  .post :global(a) {
    color: rgb(var(--accent));
  }
  .post :global(img) {
    @apply rounded-md shadow-md;
    margin: 0.75em 0;
  }
</style>
